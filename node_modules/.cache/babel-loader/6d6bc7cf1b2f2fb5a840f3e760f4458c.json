{"ast":null,"code":"import _slicedToArray from\"/home/pavlos/Office/projects/new/admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import fetch from\"node-fetch\";import AbortController from\"abort-controller\";var FILE_FORMATS=[\"image/jpeg\",\"image/png\",\"image/gif\",\"image/webp\",\"image/svg+xml\",\"image/tiff\",\"image/bmp\"],isImage=function isImage(object){if(!(\"type\"in object))return false;if(FILE_FORMATS.some(function(format){return format===object.type;}))return true;},BACKEND_HOST=\"http://\".concat(process.env.REACT_APP_DOMAIN||\"localhost\",\":\").concat(process.env.REACT_APP_BACKEND_PORT||8080,\"/api\"),REQ_TIMEOUT=10000;// 10 seconds\nfunction checkStatus(response){if(response.status>=200&&response.status<300){return response;}else{var error=new Error(response.statusText);error.name=response.statusText;error.response=response;throw error;}}function parseJSON(response){return response.json();}function errors(err){if(err.name===\"Not Found\"){return{ok:false,payload:{redirect:\"/404\"}};}else{return{ok:false,payload:{redirect:\"/500\"}};}}function constructUrl(path,params){var domain=BACKEND_HOST.concat(\"\",path),url=new URL(domain);if(!params)return url;Object.keys(params).forEach(function(param){url.searchParams.append(param,params[param]);});return url;}function makeHeaders(isFile){if(isFile)return{\"Accept\":\"application/json\"};else return{\"Content-Type\":\"application/json\",\"Accept\":\"application/json\"};}function encodeMulti(payload){var formData=new FormData();Object.entries(payload).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],val=_ref2[1];if(typeof val===\"object\"&&key!==\"img\")val=JSON.stringify(val);formData.set(key,val);});return formData;}var backend={get:function get(_ref3){var url=_ref3.url,payload=_ref3.payload,params=_ref3.params;// READ\nvar abController=new AbortController(),timeout=setTimeout(function(){return abController.abort();},REQ_TIMEOUT);url=constructUrl(url,params);return fetch(url,{method:\"get\",headers:{\"Content-Type\":\"application/json\",\"Accept\":\"application/json\"},signal:abController.signal,credentials:\"include\"}).then(checkStatus).then(parseJSON).catch(errors).finally(function(){return clearTimeout(timeout);});},post:function post(_ref4){var url=_ref4.url,payload=_ref4.payload,params=_ref4.params;// CREATE\nvar file=false;if(payload.img&&isImage(payload.img))file=true;var abController=new AbortController(),timeout=setTimeout(function(){return abController.abort();},REQ_TIMEOUT);url=constructUrl(url,params);return fetch(url,{method:\"post\",body:file?encodeMulti(payload):JSON.stringify(payload),headers:makeHeaders(file),signal:abController.signal,credentials:\"include\"}).then(checkStatus).then(parseJSON).catch(errors).finally(function(){return clearTimeout(timeout);});},delete:function _delete(_ref5){var url=_ref5.url,payload=_ref5.payload,params=_ref5.params;// DELETE\nvar abController=new AbortController(),timeout=setTimeout(function(){return abController.abort();},REQ_TIMEOUT);url=constructUrl(url,params);return fetch(url,{method:\"delete\",body:JSON.stringify(payload),headers:{\"Content-Type\":\"application/json\",\"Accept\":\"application/json\"},signal:abController.signal,credentials:\"include\"}).then(checkStatus).then(parseJSON).catch(errors).finally(function(){return clearTimeout(timeout);});},put:function put(_ref6){var url=_ref6.url,payload=_ref6.payload,params=_ref6.params;// UPDATE\nvar file=false;if(payload.img&&isImage(payload.img))file=true;var abController=new AbortController(),timeout=setTimeout(function(){return abController.abort();},REQ_TIMEOUT);url=constructUrl(url,params);return fetch(url,{method:\"put\",body:file?encodeMulti(payload):JSON.stringify(payload),headers:makeHeaders(file),signal:abController.signal,credentials:\"include\"}).then(checkStatus).then(parseJSON).catch(errors).finally(function(){return clearTimeout(timeout);});}};export default backend;","map":{"version":3,"sources":["/home/pavlos/Office/projects/new/admin-client/src/lib/backend.js"],"names":["fetch","AbortController","FILE_FORMATS","isImage","object","some","format","type","BACKEND_HOST","process","env","REACT_APP_DOMAIN","REACT_APP_BACKEND_PORT","REQ_TIMEOUT","checkStatus","response","status","error","Error","statusText","name","parseJSON","json","errors","err","ok","payload","redirect","constructUrl","path","params","domain","concat","url","URL","Object","keys","forEach","param","searchParams","append","makeHeaders","isFile","encodeMulti","formData","FormData","entries","key","val","JSON","stringify","set","backend","get","abController","timeout","setTimeout","abort","method","headers","signal","credentials","then","catch","finally","clearTimeout","post","file","img","body","delete","put"],"mappings":"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","sourcesContent":["import fetch from \"node-fetch\";\nimport AbortController from \"abort-controller\";\n\nconst\nFILE_FORMATS = [\n  \"image/jpeg\",\n  \"image/png\",\n  \"image/gif\",\n  \"image/webp\",\n  \"image/svg+xml\",\n  \"image/tiff\",\n  \"image/bmp\",\n],\nisImage = (object) => {\n  if (!(\"type\" in object)) return false;\n  if (FILE_FORMATS.some(format => format === object.type)) return true;\n},\nBACKEND_HOST = `http://${process.env.REACT_APP_DOMAIN || \"localhost\"}:${process.env.REACT_APP_BACKEND_PORT || 8080}/api`,\nREQ_TIMEOUT = 10000; // 10 seconds\n\nfunction checkStatus(response) {\n    if (response.status >= 200 && response.status < 300) {\n    return response;\n  } else {\n    const error = new Error(response.statusText);\n    error.name = response.statusText;\n    error.response = response;\n    throw error;\n  }\n}\n\nfunction parseJSON(response) {\n  return response.json();\n}\n\nfunction errors(err)  {\n  if (err.name === \"Not Found\") {\n    return {ok: false, payload: {redirect: \"/404\"}};\n  } else {\n    return {ok: false, payload: {redirect: \"/500\"}};\n  }\n}\n\nfunction constructUrl(path, params) {\n  const domain = BACKEND_HOST.concat(\"\", path),\n        url = new URL(domain);\n\n  if (!params) return url;\n  Object.keys(params).forEach(param => {\n    url.searchParams.append(param, params[param]);\n  });\n  return url;\n}\n\nfunction makeHeaders(isFile) {\n  if (isFile) return {\n    \"Accept\": \"application/json\",\n  }; else return {\n    \"Content-Type\": \"application/json\",\n    \"Accept\": \"application/json\",\n  };\n}\n\nfunction encodeMulti(payload) {\n  let formData = new FormData();\n  Object.entries(payload).forEach(([key, val]) => {\n    if (typeof val === \"object\" && key !== \"img\") val = JSON.stringify(val);\n    formData.set(key, val);\n  });\n  return formData;\n}\n\nconst backend = {\n  get({url, payload, params}) { // READ\n    const abController = new AbortController(),\n          timeout = setTimeout(\n            () => abController.abort(),\n            REQ_TIMEOUT);\n\n    url = constructUrl(url, params);\n    return fetch(url, {\n      method: \"get\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/json\",\n      },\n      signal: abController.signal,\n      credentials: \"include\",\n    }).then(checkStatus)\n      .then(parseJSON)\n      .catch(errors)\n      .finally(() => clearTimeout(timeout));\n  },\n  post({url, payload, params}) { // CREATE\n    let file = false;\n    if (payload.img && isImage(payload.img)) file = true;\n    const abController = new AbortController(),\n          timeout = setTimeout(\n            () => abController.abort(),\n            REQ_TIMEOUT);\n\n    url = constructUrl(url, params);\n    return fetch(url, {\n      method: \"post\",\n      body: file ? encodeMulti(payload) : JSON.stringify(payload),\n      headers: makeHeaders(file),\n      signal: abController.signal,\n      credentials: \"include\",\n    }).then(checkStatus)\n      .then(parseJSON)\n      .catch(errors)\n      .finally(() => clearTimeout(timeout));\n  },\n  delete({url, payload, params}) { // DELETE\n    const abController = new AbortController(),\n          timeout = setTimeout(\n            () => abController.abort(),\n            REQ_TIMEOUT);\n\n    url = constructUrl(url, params);\n    return fetch(url, {\n      method: \"delete\",\n      body: JSON.stringify(payload),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/json\",\n      },\n      signal: abController.signal,\n      credentials: \"include\",\n    }).then(checkStatus)\n      .then(parseJSON)\n      .catch(errors)\n      .finally(() => clearTimeout(timeout));\n  },\n  put({url, payload, params}) { // UPDATE\n    let file = false;\n    if (payload.img && isImage(payload.img)) file = true;\n    const abController = new AbortController(),\n          timeout = setTimeout(\n            () => abController.abort(),\n            REQ_TIMEOUT);\n\n    url = constructUrl(url, params);\n    return fetch(url, {\n      method: \"put\",\n      body: file ? encodeMulti(payload) : JSON.stringify(payload),\n      headers: makeHeaders(file),\n      signal: abController.signal,\n      credentials: \"include\",\n    }).then(checkStatus)\n      .then(parseJSON)\n      .catch(errors)\n      .finally(() => clearTimeout(timeout));\n  }\n};\n\nexport default backend;\n\n\n"]},"metadata":{},"sourceType":"module"}