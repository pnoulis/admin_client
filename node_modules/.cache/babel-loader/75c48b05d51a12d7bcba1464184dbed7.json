{"ast":null,"code":"import _objectSpread from\"/home/pavlos/Office/projects/new/admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _taggedTemplateLiteral from\"/home/pavlos/Office/projects/new/admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import{useEffect}from\"react\";import{useBackend,renderStatus}from\"lib/hooks\";import{PANEL_STORE,APP_STORE,FORM_STORE}from\"lib/stores\";import{FORM_UTILS}from\"lib/utils\";import{useTableContext,Row,Cell}from\"./Table\";import{NotBeingEdited,BeingEdited}from\"components/Fields\";import toggleStyle from\"./toggles.module.scss\";import styled from\"styled-components\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ifErrors=FORM_UTILS.ifErrors,isFormReady=FORM_UTILS.isFormReady;var Error=styled.p(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\nwidth: max-content;\\nmargin: auto;\\nfont-size: var(--font-size-2large);\\ncolor: var(--color-error);\\npadding: 5px 0;\\nfont-weight: bold;\\n\"]))),RenderThis=function RenderThis(_ref){var children=_ref.children;if(!children)return null;return/*#__PURE__*/_jsx(Row,{span:true,children:children});},renderErrors=function renderErrors(errs){return errs?errs.map(function(err,i){return/*#__PURE__*/_jsx(Error,{children:err},i);}):null;};export default function FormRow(_ref2){var notify=_ref2.notify,data=_ref2.data,edit=_ref2.edit;var _APP_STORE$useAppCont=APP_STORE.useAppContext(),setApp=_APP_STORE$useAppCont.setApp,_PANEL_STORE$usePanel=PANEL_STORE.usePanelContext(),setPanel=_PANEL_STORE$usePanel.setPanel,_useTableContext=useTableContext(),cellMap=_useTableContext.cellMap,target=_useTableContext.target,formSchema=_useTableContext.formSchema,_FORM_STORE$useForm=FORM_STORE.useForm(_objectSpread(_objectSpread({},formSchema),{},{fields:_objectSpread(_objectSpread({},formSchema.fields),data),new:!data,edit:edit})),form=_FORM_STORE$useForm.form,setForm=_FORM_STORE$useForm.setForm,_useBackend=useBackend(),setReq=_useBackend.setReq,status=_useBackend.status,res=_useBackend.res;console.log(form);useEffect(function(){if(status||!form.toggled)return null;switch(form.toggled){case\"edit\":setForm(\"edit\",true);break;case\"cancel\":setForm(\"refreshForm\");break;case\"delete\":if(form.new)return null;setTimeout(function(){return setReq({method:\"delete\",url:target,payload:{id:form.fields._id,oldImg:form.fields.img}});},500);break;case\"done\":var _isFormReady=isFormReady(form.fields),ready=_isFormReady.ready,fieldErrors=_isFormReady.fieldErrors;if(!ready)return setForm(\"setErrors\",fieldErrors);setForm(\"edit\",false);if(form.new){setTimeout(function(){return setReq({method:\"post\",url:target,payload:form.fields});},500);}else{setTimeout(function(){return setReq({method:\"put\",url:target,payload:form.fields});},500);}break;default:return null;}notify&&notify(form.toggled);},[form.toggled]);useEffect(function(){if(!res)return null;var payload=res.payload;if(!res.ok)setForm(\"edit\",true);if(payload.fieldErrors)return setTimeout(function(){return setForm(\"setErrors\",payload.fieldErrors);},1000);if(payload.flashMessage)setTimeout(function(){return setApp(\"addFlash\",{flashId:payload.flashMessage});},1000);if(res.ok){form.new&&setForm(\"toggle\",\"cancel\");setTimeout(function(){return setPanel(\"setData\",payload);},1500);}},[res]);return/*#__PURE__*/_jsxs(FORM_STORE.formContext.Provider,{value:_objectSpread(_objectSpread({},form),{},{setForm:setForm}),children:[/*#__PURE__*/_jsxs(Row,{children:[Object.keys(cellMap).map(function(h,i){return/*#__PURE__*/_jsx(Cell,{children:typeof cellMap[h]===\"function\"?cellMap[h]():cellMap[h]},i);}),/*#__PURE__*/_jsx(Cell,{children:form.edit?/*#__PURE__*/_jsx(BeingEdited,{style:toggleStyle}):/*#__PURE__*/_jsx(NotBeingEdited,{style:toggleStyle})},Object.keys(form.fields).length)]}),/*#__PURE__*/_jsx(RenderThis,{children:renderErrors(ifErrors(form.fieldErrors))||renderStatus(status)})]});}","map":{"version":3,"sources":["/home/pavlos/Office/projects/new/admin-client/src/components/Tables/FormRow.jsx"],"names":["useEffect","useBackend","renderStatus","PANEL_STORE","APP_STORE","FORM_STORE","FORM_UTILS","useTableContext","Row","Cell","NotBeingEdited","BeingEdited","toggleStyle","styled","ifErrors","isFormReady","Error","p","RenderThis","children","renderErrors","errs","map","err","i","FormRow","notify","data","edit","useAppContext","setApp","usePanelContext","setPanel","cellMap","target","formSchema","useForm","fields","new","form","setForm","setReq","status","res","console","log","toggled","setTimeout","method","url","payload","id","_id","oldImg","img","ready","fieldErrors","ok","flashMessage","flashId","Object","keys","h","length"],"mappings":"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","sourcesContent":["import {useEffect} from \"react\";\nimport {useBackend, renderStatus} from \"lib/hooks\";\nimport {PANEL_STORE, APP_STORE, FORM_STORE} from \"lib/stores\";\nimport {FORM_UTILS} from \"lib/utils\";\nimport {useTableContext, Row, Cell} from \"./Table\";\nimport {NotBeingEdited, BeingEdited} from \"components/Fields\";\nimport toggleStyle from \"./toggles.module.scss\";\nimport styled from \"styled-components\";\nconst {ifErrors, isFormReady} = FORM_UTILS;\n\nconst\nError = styled.p`\nwidth: max-content;\nmargin: auto;\nfont-size: var(--font-size-2large);\ncolor: var(--color-error);\npadding: 5px 0;\nfont-weight: bold;\n`,\nRenderThis = ({children}) => {\n  if (!children) return null;\n  return (\n    <Row span>{children}</Row>\n  );\n},\nrenderErrors = errs => errs ? errs.map((err, i) => <Error key={i}>{err}</Error>) : null;\n\nexport default function FormRow({notify, data, edit}) {\n  const\n  {setApp} = APP_STORE.useAppContext(),\n  {setPanel} = PANEL_STORE.usePanelContext(),\n  {cellMap, target, formSchema} = useTableContext(),\n  {form, setForm} = FORM_STORE.useForm(\n    {...formSchema, fields: {...formSchema.fields, ...data},\n     new: !data,  edit}\n  ),\n  {setReq, status, res} = useBackend();\n\n  console.log(form);\n\n  useEffect(() => {\n    if (status || !form.toggled) return null;\n\n    switch (form.toggled) {\n    case \"edit\":\n      setForm(\"edit\", true);\n      break;\n    case \"cancel\":\n      setForm(\"refreshForm\");\n      break;\n    case \"delete\":\n      if (form.new) return null;\n\n      setTimeout(() => setReq({method: \"delete\", url: target, payload: {id: form.fields._id, oldImg: form.fields.img}}), 500);\n      break;\n    case \"done\":\n      const {ready, fieldErrors} = isFormReady(form.fields);\n      if (!ready) return setForm(\"setErrors\", fieldErrors);\n      setForm(\"edit\", false);\n\n      if (form.new) {\n        setTimeout(() => setReq({method: \"post\", url: target, payload: form.fields}), 500);\n      } else {\n        setTimeout(() => setReq({method: \"put\", url: target, payload: form.fields}), 500);\n      }\n      break;\n    default:\n      return null;\n    }\n\n    notify && notify(form.toggled);\n\n  }, [form.toggled]);\n\n\n  useEffect(() => {\n    if (!res) return null;\n    const payload = res.payload;\n    if (!res.ok) setForm(\"edit\", true);\n    if (payload.fieldErrors) return setTimeout(() => setForm(\"setErrors\", payload.fieldErrors), 1000);\n    if (payload.flashMessage) setTimeout(() => setApp(\"addFlash\", {flashId: payload.flashMessage}), 1000);\n\n    if (res.ok) {\n      form.new && setForm(\"toggle\", \"cancel\");\n      setTimeout(() => setPanel(\"setData\", payload), 1500);\n    }\n  }, [res]);\n\n  return (\n    <FORM_STORE.formContext.Provider value={{...form, setForm}}>\n      <Row>\n        {Object.keys(cellMap).map((h, i) => {\n          return (\n            <Cell key={i}>\n            {typeof cellMap[h] === \"function\" ?\n             cellMap[h]() :\n             cellMap[h]}\n            </Cell >\n          );\n        })}\n        <Cell key={Object.keys(form.fields).length}>\n          {form.edit ? <BeingEdited style={toggleStyle}/> :\n           <NotBeingEdited style={toggleStyle}/>}\n        </Cell>\n      </Row>\n      {<RenderThis>{renderErrors(ifErrors(form.fieldErrors)) || renderStatus(status)}</RenderThis>}\n    </FORM_STORE.formContext.Provider>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}